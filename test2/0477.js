g.num = '0477';

g.resources = [
{		//0
	filename: 'dialogbox.png',
	type: 'image',
	use: 'spritesheet',
	size: 20.7
},{		//1
	filename: 'volume.png',
	type: 'image',
	use: 'spritesheet',
	size: .867,
	framex: 50,
	framey: 40
},{		//2
	filename: 'opt.png',
	type: 'image',
	use: 'spritesheet',
	size: .309
},{		//3
	filename: 'controls.png',
	type: 'image',
	use: 'spritesheet',
	size: 6.82,
	framex: 50,
	framey: 40
},{		//4
	filename: 'toucharrows.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 2,
	frameheight: 4,
	size: 11.6
},{		//5
	filename: 'tony.png',
	type: 'image',
	use: 'spritesheet',
	framex: 174,
	framey: 250,
	size: 12.6
},{		//6
	filename: 'room1/front_bg.png',
	type: 'image',
	use: 'background',
	size: 197
},
{		//7
	filename: 'room1/front_bed.png',
	type: 'image',
	use: 'spritesheet',
	size: 7.8
},
{		//8
	filename: 'room1/front_desk.png',
	type: 'image',
	use: 'spritesheet',
	size: 7.1
},
{		//9
	filename: 'room1/front_hitbox.png',
	type: 'image',
	use: 'hitbox',
	size: 11.2
},
{		//10
	filename: 'psyche.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 2,
	frameheight: 2,
	size: 8
},
{		//11
	filename: 'dialog.txt',
	type: 'text',
	use: 'dialog',
	size: 20
},
{		//12
	filename: 'room1/rear_hitbox.png',
	type: 'image',
	use: 'hitbox',
	size: 12
},
{		//13
	filename: 'room1/rear_bg.png',
	type: 'image',
	use: 'background',
	size: 320
},
{		//14
	filename: 'swap.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 2,
	frameheight: 1,
	size: 5
},
{		//15
	filename: 'computer/bg.png',
	type: 'image',
	use: 'background',
	size: 10
},
{		//16
	filename: 'computer/frame.png',
	type: 'image',
	use: 'background',
	size: 10
},
{		//17
	filename: 'computer/apps.png',
	type: 'image',
	use: 'spritesheet',
	size: 10,
	framewidth: 3,
	frameheight: 2
},
{		//18
	filename: 'room1/door.png',
	type: 'image',
	use: 'spritesheet',
	size: 4.1
},
{		//19
	type: 'meta',
	use: 'quiltdata',
	patchx: 500,
	patchy: 500,
	width: 3000,
	height: 2000
},
,,,,,,
,,,,,,		//20-43
,,,,,,
,,,,,,
{		//44
	filename: 'outside/hitbox.png',
	type: 'image',
	use: 'hitbox',
	scale: 2,
	size: 15.6
},
{		//45
	filename: 'outside/house.png',
	type: 'image',
	use: 'background',
	size: 85.6
},
{		//46
	filename: 'outside/tony-small.png',
	type: 'image',
	use: 'spritesheet',
	framex: 87,
	framey: 125,
	size: 18.7
},
{		//47
	filename: 'outside/fence-front.png',
	type: 'image',
	use: 'background',
	size: 105
},
{		//48
	filename: 'outside/ramp.png',
	type: 'image',
	use: 'background',
	size: 14.5
},
{		//49
	filename: 'outside/porch.png',
	type: 'image',
	use: 'background',
	size: 24.7
},
{		//50
	filename: 'outside/awning.png',
	type: 'image',
	use: 'background',
	size: 46.8
},
{		//51
	filename: 'outside/gramma.png',
	type: 'image',
	use: 'spritesheet',
	framex: 97,
	framey: 169,
	size: 8.5
},
{		//52
	filename: 'room1/front_cabinet.png',
	type: 'image',
	use: 'spritesheet',
	size: 2.2
},
{		//53
	filename: 'room1/rear_bed.png',
	type: 'image',
	use: 'spritesheet',
	size: 5.7
},
{		//54
	filename: 'room1/rear_desk.png',
	type: 'image',
	use: 'spritesheet',
	size: 7.1
},
{		//55
	filename: 'room1/rear_bookshelf.png',
	type: 'image',
	use: 'spritesheet',
	size: 2.1
},
{		//56
	filename: 'computer/chumnames.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 6,
	size: 7.5
},
{		//57
	filename: 'computer/chumrollback.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 3.2
},
{		//58
	filename: 'computer/homebtn.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 1.6
},
{		//59
	filename: 'computer/notify.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 1.1
},
{		//60
	filename: 'computer/pc-bigbox.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 2.2
},
{		//61
	filename: 'computer/pccard.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 2.8
},
{		//62
	filename: 'computer/pcmood.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 2.7
},
{		//63
	filename: 'computer/pc-text.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 1.5
},
{		//64
	filename: 'computer/ie-bottom.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 11.7
},
{		//65
	filename: 'computer/ie-top.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 16.6
},
{		//66
	filename: 'computer/urls.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 2,
	size: 3
},
{		//67
	filename: 'computer/da.png',
	type: 'image',
	use: 'background',
	size: 356
},
{		//68
	filename: 'computer/tabhighlight.png',
	type: 'image',
	use: 'spritesheet',
	framewidth: 1,
	frameheight: 1,
	size: 0.2
},
{		//69
	filename: 'hall1/bg.png',
	type: 'image',
	use: 'background',
	size: 36.5
},
{		//70
	filename: 'hall1/hitbox.png',
	type: 'image',
	use: 'hitbox',
	size: 5.8,
	scale: 2
},
{		//71
	filename: 'hall1/wall.png',
	type: 'image',
	use: 'background',
	size: 2.9
}
];


var allrecs = [];
for (var i = 0; i < g.resources.length; i++)
{
	allrecs[i] = i;
}
	
	
function qdata(name, start, width, height, except) {
	var out = [];
	for (var i = 0; i < height; i++)
	{
		var inout = [];
		for (var j = 0; j < width; j++)
		{
			var n = i*width+j;
			var h = n + start + 1;
			if (typeof except[n] == 'number')
				n = except[n];
			else
				g.resources[h] = {filename:name+(n+1)+'.png', type:'image', use: 'background', size: 20};
			inout[j] = n+start+1;
		}
		out[i] = inout;
	}
	g.resources[start].data = out;
}

qdata('outside/quilt/bg_',19, 6, 4, {});

g.globalstate = {};

g.dialog.boxrec = 0;
g.dialog.prefs = {
	'_': {
		color: 'black',
		states: {'_':{frames: []}}
	}
};

g.ui.volrec = 1;
g.ui.optrec = 2;
g.ui.controlsrec = 3;

g.ui.controlsdlg = 'controls';
g.ui.aboutdlg = 'about';

g.ui.volrect = new Rectangle(20, 10, 50, 40, true);
g.ui.optrect = new Rectangle(530, 10, 31, 40, true);
g.ui.controlsrect = new Rectangle(580, 10, 50, 40, true);

//g.area.currentarea = 3;

g.gfx.pixels = {
	0x000000: 0,
	0xFFFFFF: 1
};

g.controls.buttons = ['left','right','up','down','space'];
g.controls.keysets = [
	{
		name: 'Arrow Keys',
		description: 'Arrow keys to move. Spacebar (or click, assuing space would work also) to interact with things.',
		type: 'keyboard',
		left: 37,
		right: 39,
		up: 38,
		down: 40,
		space: 32
	},
	{
		name: 'WASD Keys',
		description: 'WASD keys to move. Spacebar (or click, assuming space would work also) to interact with things.',
		type: 'keyboard',
		left: 65,
		right: 68,
		up: 87,
		down: 83,
		space: 32
	},
	{
		name: 'Touch input',
		description: 'Use the onscreen keys move around. Tap on things to interact with them, assuming your character is in range to do so.',
		type: 'touch',
		controls: ['leftbtn', 'rightbtn', 'upbtn', 'downbtn'],
		left: function(ks) {return ks.leftbtn.pressed;},
		right: function(ks) {return ks.rightbtn.pressed;},
		up: function(ks) {return ks.upbtn.pressed;},
		down: function(ks) {return ks.downbtn.pressed;},
		upbtn: {
			type: 'button',
			active: false,
			pressed: false,
			sprite: 4,
			startframe: 0,
			x: 300,
			y: 0,
			dim: new Rectangle(300, 22, 77, 35, true)
		},
		downbtn: {
			type: 'button',
			active: false,
			pressed: false,
			sprite: 4,
			startframe: 6,
			x: 300,
			y: 373,
			dim: new Rectangle(300, 395, 77, 35, true)
		},
		leftbtn: {
			type: 'button',
			active: false,
			pressed: false,
			sprite: 4,
			startframe: 2,
			x: 0,
			y: 190,
			dim: new Rectangle(23, 190, 35, 77, true)
		},
		rightbtn: {
			type: 'button',
			active: false,
			pressed: false,
			sprite: 4,
			startframe: 4,
			x: 573,
			y: 190,
			dim: new Rectangle(596, 190, 35, 77, true)
		},
		
	}
];

g.area.funcs = {
	hswalk: function(ca) {
		g.gfx.draw(ca.bg, ca.x, ca.y, 0, g.gfx.layers.bg);
		for (var i in ca.objects)											//draw each 'object'
		{
			var j = ca.objects[i];
			if (!j.aopt && !j.a)
				j.a = 100;
			else if (j.aopt == 'fadebehind')
			{
				var p = ca.sprites[0].y + 206;
				if (p > j.p && j.a < 100)
					j.a += 2;
				else if (p < j.p && j.a > 0)
					j.a -= 2;
			}
			var p = j.p;
			if (typeof p == 'function')
				p = p();
			g.gfx.fbdraw(j.recid, j.x, j.y, 0, p, {x:false,y:false}, j.a/100);
		}
		var p = ca.sprites[ca.player];
		t = p.x-ca.x;
		if (t < 100)			//scroll left
			ca.x = p.x - 100;
		else if (t > 400)		//scroll right
			ca.x = p.x - 400;
		t = p.y-ca.y;
		if (t < 25)				//scroll up
			ca.y = p.y - 25;
		else if (t > 200)		//scroll down
			ca.y = p.y - 200;
		
		var sen = false;
		if (ca.twin)
			sen = g.area.funcs.canswap(ca, g.area.areas[ca.twin]);
		g.gfx.draw(14, 100, 15, (sen?0:1), g.gfx.layers.ui);
		if (sen && g.controls.istouch(new Rectangle(100, 15, 30, 30, true)))
			g.area.currentarea = g.area.areas[g.area.currentarea].twin;		//god help us
	},
	canswap: function(ca, ta) {
		var t = g.area.currentarea;
		g.area.currentarea = ca.twin;
		ta.onSwap(ca, ta);
		if (g.sprites.func.hitgen(ta.sprites[0], ['top','bottom','left','right'], function(px, num, name) {
			if (px == 0)
				return 'stop';
		}) == 'stopped')
		{
			g.area.currentarea = t;
			return false;
		}
		g.area.currentarea = t;
		return true;
	},
	doent: function(ca, ent) {
		var tent = ca.ents[ent];
		if (tent)
		{
			ca.x = tent[0];
			ca.y = tent[1];
			ca.sprites[0].x = tent[2];
			ca.sprites[0].y = tent[3];
			ca.sprites[0].faceleft = tent[4];
			ca.sprites[0].faceback = tent[5];
			ca.sprites[0].xspd = ca.sprites[0].yspd = 0;
		}
	}
};

g.area.areas = [
	{
		reclist: allrecs,
		onLoad: function() { g.ui.enabled = false; },
		onActivate: function() {
			g.timeouts.addtimeout(300, function(timer) {
				var frame = 0;
				if (timer > 260)
					frame = Math.floor((timer%6)/3);
				else if (timer > 180)
					frame = 1;
				else if (timer > 140)
					frame = Math.floor((timer%6)/3)+2;
				else
					frame = 3;
				if (timer == 30)
					g.area.loadarea(1, 'inout', 'white', 'start');
				g.gfx.draw(10, 107, 150, frame, 0);
				if (timer == 0)
					g.ui.enabled = true;
			}, true);
		},
		process: function() {}
	},
	
	{
		reclist: allrecs,
		player: 0,
		x: 100,
		y: 304,
		bg: 6,
		hitbox: 9,
		ents: {
			door: [330, 304, 685, 338, true, false]
		},
		onLoad: function(ent) {
			g.area.funcs.doent(g.area.areas[1], ent);
			g.gfx.setbgcolor('white');
		},
		onActivate: function() {
			if (!g.globalstate.start)
			{
				g.globalstate.start = true;
				g.frozen = true;
				g.dialog.notice('You are now Tony.');
			}
		},
		process: function(ca) {
			g.area.funcs.hswalk(ca);
		},
		twin: 2,
		onSwap: function(ca, ta) {
			ta.sprites[0].y = 450 + 980 - (ca.sprites[0].y + 206) - 206;
			ta.sprites[0].x = 20 + 1230 - (ca.sprites[0].x + 85) - 85;
			ta.sprites[0].faceleft = !ca.sprites[0].faceleft;
			ta.sprites[0].faceback = !ca.sprites[0].faceback;
			ta.sprites[0].frametimer = ca.sprites[0].frametimer;
			ta.sprites[0].xspd = -ca.sprites[0].xspd;
			ta.sprites[0].yspd = -ca.sprites[0].yspd;
			ta.x = ca.x + ta.sprites[0].x - ca.sprites[0].x;
			ta.y = ca.y + ta.sprites[0].y - ca.sprites[0].y;
		},
		objects: [
			{	//bed
				recid: 7,
				x: 38,
				y: 581,
				p: 779
			},
			{	//desk
				recid: 8,
				x: 809,
				y: 385,
				p: 621
			},
			{	//cabinet
				recid: 52,
				x: 597,
				y: 572,
				p: 970,
				a: 50
			}
		],
		sprites: [
			{
				index: 0,
				name: 'tony',
				dim: new Rectangle(30,180,110,53,true),
				x: 368,
				y: 439,
				xspd: 0,
				yspd: 0,
				xsub: 0,
				ysub: 0,
				faceleft: false,
				faceback: false,
				sheet: 5,
				frame: 0,
				frametimer: 0
			},
			{
				name: 'examine',
				x: 421,
				y: 280,
				dim: new Rectangle(0,0,260,303,true),
				object: 'bookshelf',
				dialog: 'examinebookshelf'
			},
			{
				name: 'examine',
				x: 83,
				y: 661,
				dim: new Rectangle(0,0,490,202,true),
				object: 'bed',
				dialog: 'examinebed'
			},
			{
				name: 'examine',
				x: 232,
				y: 326,
				dim: new Rectangle(0,0,211,313,true),
				object: 'posters',
				dialog: 'examineposters'
			},
			{
				name: 'examine',
				x: 1018,
				y: 465,
				dim: new Rectangle(0,0,198,272,true),
				object: 'gifts',
				dialog: 'examinegifts'
			},
			{
				name: 'area',
				x: 926,
				y: 380,
				dim: new Rectangle (0,0,143,336,true),
				option: 'Examine computer',
				callback: function() {
					g.area.areas[1].sprites[0].xspd = 0;
					g.area.areas[1].sprites[0].yspd = 0;
					g.area.currentarea = 3;
					g.area.areas[3].last = 1;
					g.ui.enabled = false;
				}
			},
			{
				name: 'area',
				x: 656,
				y: 280,
				dim: new Rectangle(0,0,180,265,true),
				option: 'Exit',
				callback: function() {
					if (!g.globalstate.gina1)
						g.dialog.notice('Nope! You still have more screwing around in here to do before you can proceed! :D');
					else
						g.area.loadarea(5, 'inout', 'black', 'door');
				}
			}
		]
	},
	{
		reclist: allrecs,
		player: 0,
		x: 0,
		y: 0,
		bg: 13,
		hitbox: 12,
		onLoad: function() {
			g.gfx.setbgcolor('white');
		},
		onActivate: function() {},
		process: function(ca) {
			g.area.funcs.hswalk(ca);
		},
		twin: 1,
		onSwap: function(ca, ta) {
			ta.sprites[0].y = 450 + 980 - (ca.sprites[0].y + 206) - 206;
			ta.sprites[0].x = 20 + 1230 - (ca.sprites[0].x + 85) - 85;
			ta.sprites[0].faceleft = !ca.sprites[0].faceleft;
			ta.sprites[0].faceback = !ca.sprites[0].faceback;
			ta.sprites[0].frametimer = ca.sprites[0].frametimer;
			ta.sprites[0].xspd = -ca.sprites[0].xspd;
			ta.sprites[0].yspd = -ca.sprites[0].yspd;
			ta.x = ca.x + ta.sprites[0].x - ca.sprites[0].x;
			ta.y = ca.y + ta.sprites[0].y - ca.sprites[0].y;
		},
		sprites: [
			{
				index: 0,
				name: 'tony',
				dim: new Rectangle(30,180,110,53,true),
				x: 368,
				y: 439,
				xspd: 0,
				yspd: 0,
				xsub: 0,
				ysub: 0,
				faceleft: false,
				faceback: false,
				sheet: 5,
				frame: 0,
				frametimer: 0
			},
			{
				name: 'area',
				x: 326,
				y: 857,
				dim: new Rectangle(0,0,247,87,true),
				option: 'Exit',
				callback: function() {
					if (!g.globalstate.gina1)
						g.dialog.notice('Nope! You still have more screwing around in here to do before you can proceed! :D');
					else
						g.area.loadarea(5, 'inout', 'black', 'door');
				}
			},
			{
				name: 'examine',
				x: 483,
				y: 260,
				dim: new Rectangle(0,0,188,300,true),
				object: 'cabinet',
				dialog: 'examinecabinet'
			},
			{
				name: 'examine',
				x: 726,
				y: 506,
				dim: new Rectangle(0,0,436,252,true),
				object: 'bed',
				dialog: 'examinebed'
			},
			{
				name: 'examine',
				x: 703,
				y: 282,
				dim: new Rectangle(0,0,440,241,true),
				object: 'posters',
				dialog: 'examineposters2'
			},
			{
				name: 'examine',
				x: 138,
				y: 280,
				dim: new Rectangle(0,0,329,379,true),
				object: 'posters',
				dialog: 'examineposters3'
			},
			{
				name: 'area',
				x: 186,
				y: 525,
				dim: new Rectangle (0,0,153,201,true),
				option: 'Examine computer',
				callback: function() {
					g.area.areas[2].sprites[0].xspd = 0;
					g.area.areas[2].sprites[0].yspd = 0;
					g.area.currentarea = 3;
					g.area.areas[3].last = 1;
					g.ui.enabled = false;
				}
			},
			{
				name: 'examine',
				x: 96,
				y: 490,
				dim: new Rectangle(0,0,143,187,true),
				object: 'gifts',
				dialog: 'examinegifts'
			}
		],
		objects: [
			{		//door
				recid: 18,
				x: 377,
				y: 515,
				p: 1000,
				a: 50
			},
			{
				recid: 53,
				x: 732,
				y: 505,
				p: 656
			},
			{
				recid: 54,
				x: 34,
				y: 493,
				p: 803
			},
			{
				recid: 55,
				x: 606,
				y: 610,
				p: 970,
				a: 50
			}
		]
	},
	{							//computer
		process: function(ca)
		{
			if (ca.entering)
				ca.enter(ca);
			g.gfx.draw(15, 0, 0, 0, g.gfx.layers.bg);
			g.gfx.draw(16, 0, 0, 0, g.gfx.layers.ui);
			if (!g.frozen && g.controls.istouch(new Rectangle(614, 414, 30, 30, true)))
				ca.exiting = true;
			switch (ca.state) {
				case 0:				//boot up
				if (ca.entering)
					break;
				ca.timer++;
				if (ca.timer > 20)
				{
					for (var i = 0; i < 5; i++)
						g.gfx.draw(17, Math.ceil(ca.xps[i] - Math.pow(1.5, -(ca.timer-50+(i*5)))), ca.yps[i], i, g.gfx.layers.sprites);
				}
				if (ca.timer == 60)
				{
					ca.state++;
					ca.timer = 0;
					if (!ca.init)
					{
						ca.init = true;
						g.globalstate.gina1 = true;
						g.dialog.show('computerintro');
					}
				}
				default:
				break;
				case 1:		//main screen
				for (var i = 0; i < 5; i++)
					g.gfx.draw(17, ca.xps[i], ca.yps[i], i, g.gfx.layers.sprites);
				break;
				case 2:		//switch out from main
				ca.timer++;
				if (ca.timer < 35)
				{
					for (var i = 0; i < 5; i++)
						g.gfx.draw(17, Math.ceil(ca.xps[i] - Math.pow(2, (ca.timer-(i*5)))), ca.yps[i], i, g.gfx.layers.sprites);
				}
				else
				{
					ca.timer = 0;
					ca.state = ca.nextstate;
				}
				break;
				case 3:		//boot up pesterchum
				ca.timer++;
				g.gfx.draw(58, 307, 44, 0, g.gfx.layers.sprites, {x:false, y:false}, ca.timer/60);
				g.gfx.draw(61, 55, -Math.pow(1.5, -(ca.timer - 20)), 0, g.gfx.layers.sprites);
				g.gfx.draw(57, 69-Math.pow(1.6, -(ca.timer - 20)), 115, 0, g.gfx.layers.sprites);
				g.gfx.draw(62, 69, 338+Math.pow(1.5, -(ca.timer - 20)), 0, g.gfx.layers.sprites);
				for (var i = 0; i < 3; i++)
					g.gfx.draw(56, 75-Math.pow(1.6, -(ca.timer - 20)), 163 + i*23, i + (ca.chums[i].online?3:0), g.gfx.layers.prioritysprites);
				if (ca.timer == 30)
				{
					ca.timer = 0;
					ca.state++;
				}
				break;
				case 4:		//pesterchum
				if (!ca.initpc)
				{
					g.dialog.show('comppcintro');
					ca.initpc = true;
				}
				g.gfx.draw(58, 307, 44, 0, g.gfx.layers.sprites, {x:false, y:false}, .5);
				g.gfx.draw(61, 55, 0, 0, g.gfx.layers.sprites);
				g.gfx.draw(57, 69, 115, 0, g.gfx.layers.sprites);
				g.gfx.draw(62, 69, 338, 0, g.gfx.layers.sprites);
				for (var i = 0; i < 3; i++)
					g.gfx.draw(56, 75, 163 + i*23, i + (ca.chums[i].online?3:0), g.gfx.layers.prioritybg);
				if (!ca.spotimer)
					ca.spotimer = 0;
				ca.spotimer++;
				if (ca.spotimer < 30)
				{
					for (var i = 0; i < 3; i++)
					{
						if (ca.chums[i].pestering)
							g.gfx.draw(59, 278, 146 + i*23, 0, g.gfx.layers.prioritybg);
					}
				}
				else if (ca.spotimer == 60)
					ca.spotimer = 0;
				if (!g.frozen && g.controls.istouch(new Rectangle(307, 38, 30, 30, true)))
				{
					ca.timer = 30;
					ca.state = 5;
				}
				break;
				case 5:		//shut down pesterchum
				ca.timer--;
				g.gfx.draw(58, 307, 44, 0, g.gfx.layers.sprites, {x:false, y:false}, ca.timer/60);
				g.gfx.draw(61, 55, -Math.pow(1.5, -(ca.timer - 20)), 0, g.gfx.layers.sprites);
				g.gfx.draw(57, 69-Math.pow(1.6, -(ca.timer - 20)), 115, 0, g.gfx.layers.sprites);
				g.gfx.draw(62, 69, 338+Math.pow(1.5, -(ca.timer - 20)), 0, g.gfx.layers.sprites);
				for (var i = 0; i < 3; i++)
					g.gfx.draw(56, 75-Math.pow(1.6, -(ca.timer - 20)), 163 + i*23, i + (ca.chums[i].online?3:0), g.gfx.layers.prioritybg);
				if (ca.timer == 0)
				{
					ca.timer = 0;
					ca.state = 0;
				}
				break;
				case 6:		//boot up IE
				ca.timer++;
				if (ca.timer < 15)
				{
					g.gfx.draw(64, 26, 381+Math.pow(1.5, -(ca.timer - 10)), 0, g.gfx.layers.prioritybg);
					g.gfx.draw(65, 29, 19-Math.pow(1.5, -(ca.timer - 10)), 0, g.gfx.layers.prioritybg);
					g.gfx.draw(68, ca.tabs[ca.curtab].dim.x1-4, ca.tabs[ca.curtab].dim.y1-4-Math.pow(1.5, -(ca.timer - 10)), 0, g.gfx.layers.prioritybg);
					g.gfx.draw(66, 172, 391+Math.pow(1.5, -(ca.timer - 10)), ca.curtab, g.gfx.layers.prioritybg);
				}
				else
				{
					g.gfx.draw(64, 26, 381, 0, g.gfx.layers.prioritybg);
					g.gfx.draw(65, 29, 19, 0, g.gfx.layers.prioritybg);
					g.gfx.draw(68, ca.tabs[ca.curtab].dim.x1-4, ca.tabs[ca.curtab].dim.y1-4, 0, g.gfx.layers.prioritybg);
					g.gfx.draw(66, 172, 391, ca.curtab, g.gfx.layers.prioritybg);
					g.gfx.draw(ca.tabs[ca.curtab].page, -24, ca.tabs[ca.curtab].curscr-107, 0, g.gfx.layers.sprites, {x:false, y:false}, (ca.timer-15)/30);
				}
				if (ca.timer == 45)
				{
					ca.timer = 0;
					ca.state++;
				}
				break;
				case 7:		//IE
				if (!ca.initie)
				{
					g.dialog.show('compieintro');
					ca.initie = true;
				}
				for (var i = 0; i < ca.tabs.length; i++)
				{
					if (!g.frozen && i != ca.curtab && g.controls.istouch(ca.tabs[i].dim))
						ca.curtab = i;
				}
				if (ca.scrollfinger == -1)
				{
					ca.scrollfinger = g.controls.istouchfinger(new Rectangle(28, 107, 529, 273, true));
					if (g.frozen)
						ca.scrollfinger = -1;
					if (ca.scrollfinger != -1)
					{
						ca.scrollstart = g.p[ca.scrollfinger].y;
						ca.pagestart = ca.tabs[ca.curtab].curscr;
					}
				}
				else
				{
					if (!g.p[ca.scrollfinger])
						ca.scrollfinger = -1;
					else
						ca.tabs[ca.curtab].curscr = ca.scrollstart - g.p[ca.scrollfinger].y + ca.pagestart;
				}
				if (ca.tabs[ca.curtab].curscr < 0)
					ca.tabs[ca.curtab].curscr = 0;
				else if (ca.tabs[ca.curtab].curscr > ca.tabs[ca.curtab].maxscr)
					ca.tabs[ca.curtab].curscr = ca.tabs[ca.curtab].maxscr;
				g.gfx.draw(64, 26, 381, 0, g.gfx.layers.prioritybg);
				g.gfx.draw(65, 29, 19, 0, g.gfx.layers.prioritybg);
				g.gfx.draw(68, ca.tabs[ca.curtab].dim.x1-4, ca.tabs[ca.curtab].dim.y1-4, 0, g.gfx.layers.prioritybg);
				g.gfx.draw(66, 172, 391, ca.curtab, g.gfx.layers.prioritybg);
				g.gfx.draw(ca.tabs[ca.curtab].page, -24, ca.tabs[ca.curtab].curscr-107, 0, g.gfx.layers.sprites);
				if (!g.frozen && g.controls.istouch(new Rectangle(42, 388, 30, 30, true)))
				{
					ca.state++;
					ca.timer = 15;
				}
				break;
				case 8:		//shut down IE
				ca.timer--;
				g.gfx.draw(64, 26, 381+Math.pow(1.5, -(ca.timer - 10)), 0, g.gfx.layers.prioritybg);
				g.gfx.draw(65, 29, 19-Math.pow(1.5, -(ca.timer - 10)), 0, g.gfx.layers.prioritybg);
				g.gfx.draw(68, ca.tabs[ca.curtab].dim.x1-4, ca.tabs[ca.curtab].dim.y1-4-Math.pow(1.5, -(ca.timer - 10)), 0, g.gfx.layers.prioritybg);
				g.gfx.draw(66, 172, 391+Math.pow(1.5, -(ca.timer - 10)), ca.curtab, g.gfx.layers.prioritybg);
				g.gfx.draw(ca.tabs[ca.curtab].page, -24, ca.tabs[ca.curtab].curscr-107, 0, g.gfx.layers.sprites, {x:false, y:false}, ca.timer/15);
				if (ca.timer == 0)
					ca.state = 0;
				break;
			}
			if (ca.exiting)
				ca.exit(ca);
		},
		onLoad: function() {},
		onActivate: function() {},
		reclist: allrecs,
		timer: 0,
		init: false,
		initpc: false,
		initie: false,
		state: 0,
		x:0,
		y:0,
		xps: [77, 247, 417, 77, 247],
		yps: [60, 60, 60, 240, 240],
		chums: [
			{online: true, pestering: false},
			{online: false, pestering: false},
			{online: false, pestering: false}
		],
		tabs: [
			{dim: new Rectangle(156, 37, 112, 61, true), page: 67, maxscr: 550, curscr: 50},
			{dim: new Rectangle(296, 37, 112, 61, true), page: 67, maxscr: 200, curscr: 50}
		],
		curtab: 0,
		scrollfinger: -1,
		scrollstart: 0,
		pagestart: 0,
		player: 0,
		sprites: [
			{
				name: 'null',
				x: 0,
				y: 0,
				dim: new Rectangle(0,0,650,450)
			},
			{
				name: 'compbtn',
				num: 0
			},
			{
				name: 'compbtn',
				num: 1
			},
			{
				name: 'compbtn',
				num: 2
			},
			{
				name: 'compbtn',
				num: 3
			},
			{
				name: 'compbtn',
				num: 4
			}
		],
		last: 1,
		exiting: false,
		exittimer: 0,
		exit: function(ca) {
			ca.exittimer++;
			var a = 1;
			if (ca.exittimer < 30)
				a = ca.exittimer/30;
			g.gfx.drawfunc(function() {
				g.c.fillStyle = 'black';
				g.c.globalAlpha = a;
				g.c.fillRect(0,0,650,450);
				g.c.globalAlpha = 1;
			}, g.gfx.layers.prioritysprites);
			if (ca.exittimer == 60)
			{
				ca.exiting = false;
				ca.exittimer = 0;
				//ca.state = 0;
				//ca.timer = 0;
				g.area.currentarea = ca.last;
				g.ui.enabled = true;
				ca.entering = true;
			}
		},
		entering: true,
		entertimer: 60,
		enter: function(ca) {
			ca.entertimer--;
			var a = 1;
			if (ca.entertimer < 30)
				a = ca.entertimer/30;
			g.gfx.drawfunc(function() {
				g.c.fillStyle = 'black';
				g.c.globalAlpha = a;
				g.c.fillRect(0,0,650,450);
				g.c.globalAlpha = 1;
			}, g.gfx.layers.prioritysprites);
			if (ca.entertimer == 0)
			{
				ca.entering = false;
				ca.entertimer = 60;
			}
		}
	},
	{												//area 4 - outside
		bg: 19,
		hitbox: 44,
		reclist: allrecs,
		x: 2000,
		y: 2000,
		player: 0,
		ents: {
			door: [736, 1221, 1020, 1368, true, false],
			trapdoor: []			//tbd
		},
		onLoad: function(ent) {
			var ca = g.area.areas[4];
			g.gfx.setbgcolor('#e4a034');
			var tent = ca.ents[ent];
			if (tent)
			{
				ca.x = tent[0];
				ca.y = tent[1];
				ca.sprites[0].x = tent[2];
				ca.sprites[0].y = tent[3];
				ca.sprites[0].faceleft = tent[4];
				ca.sprites[0].faceback = tent[5];
			}
		},
		onActivate: function() {},
		process: function(ca) {
			g.area.funcs.hswalk(ca);
		},
		sprites: [
			{
				index: 0,
				name: 'tony',
				dim: new Rectangle(14,90,65,26,true),
				x: 813,
				y: 479,
				xspd: 0,
				yspd: 0,
				xsub: 0,
				ysub: 0,
				faceleft: false,
				faceback: false,
				sheet: 46,
				frame: 0,
				frametimer: 0,
				halfscale: true
			},
			{
				name: 'area',
				dim: new Rectangle(0, 0, 112, 253),
				x: 1059,
				y: 1211,
				option: 'Enter',
				callback: function() {
					g.area.loadarea(1, 'inout', 'white', 'door');
				}
			}
		],
		objects: [
			{					//house
				recid: 45,
				x: 813,
				y: 479,
				p: function() {		//1264, [1700,2200]:1100, 1355
					var px = g.area.areas[4].sprites[0].x;
					if (px < 1700)
						return 1264;
					else if (px > 2200)
						return 1355;
					return 1100;
				}
			},
			{					//fence
				recid: 47,
				x: 420,
				y: 861,
				p: 2150
			},
			{					//ramp
				recid: 48,
				x: 611,
				y: 1492,
				p: 1471
			},
			{					//porch
				recid: 49,
				x: 602,
				y: 1062,
				p: function() {
					var px = g.area.areas[4].sprites[0].x + g.area.areas[4].sprites[0].dim.x1 + g.area.areas[4].sprites[0].dim.width/2;
					if (px > 1225)
						return 1615;
					if (px < 602)
						return 1395;
					if (px > 809)
						return 1272;
					var f = -0.598131*px + 1736.17 + 20;
					//g.debug.adddata('Calculated swap point: '+f);
					return f;
					
				}
			},
			{					//awning
				recid: 50,
				x: 696,
				y: 932,
				p: 2000
			},
			{					//gramma
				recid: 51,
				x: 918,
				y: 1284,
				p: function() {
					if (g.area.areas[4].sprites[0].x < 950)
						return 1430;
					return 1410;
				}
			}
		]
	},
	{						//5 - hallway/stairwell
		reclist: allrecs,
		bg: 69,
		hitbox: 70,
		player: 0,
		x: 500,
		y: 200,
		ents: {},
		onLoad: function(ent) {
			g.area.funcs.doent(g.area.areas[5], ent);
			g.gfx.setbgcolor('white');
		},
		onActivate: function() {},
		process: function(ca) {
			g.area.funcs.hswalk(ca);
		},
		sprites: [
			{
				index: 0,
				name: 'tony',
				dim: new Rectangle(30,180,110,53,true),
				x: 752,
				y: 350,
				xspd: 0,
				yspd: 0,
				xsub: 0,
				ysub: 0,
				faceleft: false,
				faceback: false,
				sheet: 5,
				frame: 0,
				frametimer: 0
			}
		],
		objects: [
			{	//stairwellwall
				recid: 71,
				x: 835,
				y: 325,
				p: 744,
				a: 0,
				aopt: 'fadebehind'
			}
		],
	}
];

g.sprites.tony = {
	process: function(inst) {
		g.gfx.draw(5, inst.dim.x1, inst.dim.y1, 0, 0, {x:false,y:false}, 0.5);
	},
	playerprocess: function(inst) {
		if (typeof inst.halfscale == 'undefined')
			inst.halfscale = false;
		var scalar = inst.halfscale?2:1;
		if (!g.frozen)
		{
			var sign = g.k.left?-1:1;
			if (g.k.left || g.k.right)
			{
				var s = inst.xspd*sign*scalar;
				var c = 0;
				if (s < -100)
					c = 30;
				else if (s < -50)
					c = 15;
				else if (s < 0)
					c = 8;
				else if (s < 50)
					c = 7;
				else if (s < 100)
					c = 5;
				inst.xspd += c*sign/scalar;
			}
			else
			{
				var s = inst.xspd*scalar;
				if (s > 5)
					s -= 5;
				else if (s < -5)
					s += 5;
				else
					s = 0;
				inst.xspd = s/scalar;
			}
			sign = g.k.up?-1:1;
			if (g.k.up || g.k.down)
			{
				var s = inst.yspd*sign*scalar;
				var c = 0;
				if (s < -80)
					c = 25;
				else if (s < -40)
					c = 10;
				else if (s < 0)
					c = 8;
				else if (s < 40)
					c = 6;
				else if (s < 80)
					c = 4;
				inst.yspd += c*sign/scalar;
			}
			else
			{
				var s = inst.yspd*scalar;
				if (s > 5)
					s -= 5;
				else if (s < -5)
					s += 5;
				else
					s = 0;
				inst.yspd = s/scalar;
			}
			if (!(inst.xspd == 0 && inst.yspd == 0))
			{
				if (--inst.frametimer < 0)
				{
					inst.frametimer = 8;
					if (++inst.frame > 3)
						inst.frame = 0;
				}
			}
			else
			{
				inst.frame = 0;
				inst.frametimer = 0;
			}
			if (inst.xspd != 0)
				inst.faceleft = (inst.xspd < 0);
			if (inst.yspd != 0)
				inst.faceback = (inst.yspd < 0);
			g.sprites.func.updPosBySpd(inst);
			g.sprites.func.hitgen(inst, ['top', 'left', 'bottom', 'right'], function(px, num, name) {
				if (px != 0)
					return;
				var sign;
				if (num == 0 || num == 2)
				{
					sign = num - 1;		//top: -1, bottom: 1
					for (var i = 1; i < 15; i++)
					{
						if (g.sprites.func.hit(inst, name, {x:0, y:-i*sign}) != 0)
						{
							inst.y -= (i-1)*sign;
							inst.yspd = 0;
							break;
						}
					}
				}
				else
				{
					sign = num - 2;		//left: -1, right: 1
					for (var i = 1; i < 15; i++)
					{
						if (g.sprites.func.hit(inst, name, {x:-i*sign, y:0}) != 0)
						{
							inst.x -= (i-1)*sign;
							inst.xspd = 0;
							break;
						}
					}
				}
			});
		}
		g.debug.adddata('Player center-x: '+(inst.x+inst.dim.x1+(inst.dim.width/2)));
		g.debug.adddata('Player center-y: '+(inst.y+inst.dim.y1+(inst.dim.height/2)));
		g.gfx.fbdraw(inst.sheet, inst.x, inst.y, [0,1,0,2][inst.frame] + (inst.faceback?3:0), inst.y+inst.dim.y1+(inst.dim.height/2), {x:inst.faceleft,y:false});
		
		/*if(g.k.frame.space)
			g.area.areas[g.area.currentarea].player = inst ^ 1;*/
	}
};
g.sprites.gramma = {
	process: function(inst)
	{
		
	}
};
g.sprites['null'] = {playerprocess: function() {},process: function() {}};
g.sprites.compbtn = {
	process: function(inst)
	{
		if (!inst.dim)
		{
			inst.dim = new Rectangle(g.area.areas[3].xps[inst.num], g.area.areas[3].yps[inst.num], 155, 155, true);
			inst.x = inst.y = 0;
		}
		if (g.area.areas[3].state == 1 && g.controls.istouch(inst.dim))
		{
			if (inst.num == 3 || inst.num == 4)
				g.dialog.show('compnope');
			else if (inst.num == 1)
				g.dialog.show('compsentences');
			else if (inst.num == 0)
			{
				g.area.areas[3].state = 2;
				g.area.areas[3].timer = 0;
				g.area.areas[3].nextstate = 6;
			}
			else if (inst.num == 2)
			{
				g.area.areas[3].state = 2;
				g.area.areas[3].timer = 0;
				g.area.areas[3].nextstate = 3;
			}
		}
	}
}

birth();